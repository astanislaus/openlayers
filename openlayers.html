<!-- https://openlayers.org/en/latest/examples/cluster.html

[-214610.61991053625,6738641.461209537],
-->
<head>
    <link rel="stylesheet" href="https://openlayers.org/en/v3.20.1/css/ol.css">
</head>
<div id="map" class="map"></div>
 
 <label>cluster distance</label>
 <input id="distance" type="range" min="0" max="100" step="1" value="40"/>
 <script src="https://openlayers.org/en/v3.20.1/build/ol.js"></script>
<script>



//import Feature from 'ol/Feature.js';
var Feature = ol.Feature;
//import Map from 'ol/Map.js';
var Map = ol.Map;
//import View from 'ol/View.js';
var View = ol.View;
//import Point from 'ol/geom/Point.js';
var Point = ol.geom.Point;

//import {Tile as TileLayer, Vector as VectorLayer} from 'ol/layer.js';
var TileLayer = ol.layer.Tile;
var VectorLayer = ol.layer.Vector;

//import {Cluster, OSM, Vector as VectorSource} from 'ol/source.js';
var Cluster = ol.source.Cluster;
var OSM = ol.source.OSM;
var VectorSource  = ol.source.Vector; 

//="var " & B26 & "= ol.style." & B26 & ";"
//import {Circle as CircleStyle, Fill, Stroke, Style, Text} from 'ol/style.js';
var Circle = ol.style.Circle ;
var CircleStyle= ol.style.Circle;
var Fill= ol.style.Fill;
var Stroke= ol.style.Stroke;
var Style= ol.style.Style;
var Text= ol.style.Text;

//

var locations1 = [
[51.658665, -1.92788,"0"],  // Mark : 0
[51.657782, -1.929267,"1"],  // Mark : 1
[51.658665, -1.92788,"2"],  // Mark : 2
[51.659887, -1.927568,"3"],  // Mark : 3
[51.660719, -1.92771,"4"],  // Mark : 4
[51.66126, -1.930908,"5"],  // Mark : 5
[51.66246, -1.933075,"6"],  // Mark : 6
[51.662223, -1.934958,"7"],  // Mark : 7
[51.66131, -1.935907,"8"],  // Mark : 8
[51.659638, -1.933742,"9"],  // Mark : 9
[51.659233, -1.930221,"Hut"],  // Mark : Hut
[51.658267, -1.935367,"A"], //Mark : A
[51.657320, -1.937959,"B], //Mark : B
];

var MarkNames = locations1.map(function(val){
    return val[2];
});

var locations = locations1.map(function(val){
    return val.slice(0, -1);
});

// OpenLayers uses [lon, lat], not [lat, lon]
locations.map(function(l) {
  return l.reverse();
});

var route = new ol.geom.LineString(locations)
    .transform('EPSG:4326', 'EPSG:3857');

var routeCoords = route.getCoordinates();


//document.getElementById("Var1").innerHTML = routeCoords[0];
//document.getElementById("Var2").innerHTML = center;

      var count = 11;
      var Markfeatures = new Array(count);
      //var e = 4500000;
      for (var i = 0; i < count; ++i) {
        //var coordinates = [2 * e * Math.random() - e, 2 * e * Math.random() - e];
        Markfeatures[i] = new Feature(new Point(routeCoords[i]));
      }


//


       var distance = document.getElementById('distance');

      var count = 20000;
      var features = new Array(count);
      var e = 4500000;
      for (var i = 0; i < count; ++i) {
        var coordinates = [2 * e * Math.random() - e, 2 * e * Math.random() - e];
        features[i] = new Feature(new Point(coordinates));
      }

      var source = new VectorSource({
        features: Markfeatures //features
      });

      var clusters = new VectorLayer({
        source: source,
        style: (feature) => {
          var size = 0;
           let style = new Style({
              image: new CircleStyle({
                radius: 10,
                stroke: new Stroke({
                  color: '#fff'
                }),
                fill: new Fill({
                  color: '#3399CC'
                })
              }),
              text: new Text({
                text: MarkNames[route.B.indexOf(feature.H.geometry.B[0])/2].toString(),
                fill: new Fill({
                  color: '#fff'
                })
              })
            });
          return style;
        }
      });

      var raster = new TileLayer({
        source: new OSM()
      });

      var map = new Map({
      	// the clusters layer fails and I'm not sure why??
       layers: [raster, clusters],
       // layers: [raster],
        target: 'map',
        view: new View({
          center: routeCoords[2],//[0, 0],
          zoom: 15
        })
      });

      distance.addEventListener('input', function() {
        clusterSource.setDistance(parseInt(distance.value, 10));
      });
</script>
